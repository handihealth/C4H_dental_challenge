#NHS Code4Health Dental App Challenge

##Introduction

At the NHS Open Source Open Day to be held in Newcastle on 26th November it was proposed to run an 'on-the-day' app hack to showcase the HANDI-HOPD Open Platform Demonstrator. 

A vote was held via the [NHS Open Source programme](http://www.technologystrategy.england.nhs.uk/pg/groups/99205/) and the winner was a proposal to create an app supporting the Community Dental Service team in Northumbria, monitoring the dental health of children as part of a Safeguarding Children initiative.

A number of software development teams have offered their assistance on the 26th but since time will be extremely short on the day, this site will make a number of documents and other resources avaiable as a gentle heads-up.

The scenario and related application may seem simple but actually captures some fairly complex data including SNOMED coded items, counts, ordinals and is aligned with the the [RCP/AoMRC outpatient clinical headings](https://www.rcplondon.ac.uk/sites/default/files/standards-for-the-clinical-structure-and-content-of-patient-records.pdf). 

One of the key challenges for the hack teams will be to persist the collected information to the HANDI-HOPD platform via the openEHR Ehrscape API. This API will be unfamiliar to most of the teams involved, though some have had limited experience of working with openEHR data.

We also hope to be able to demonstrate the vendor-neutral aspect of openEHR by saving and retrieving the document to several openEHR servers, each working on completely different technical stacks.


##The Dental App Challenge Scenario

Community dental services (CDS) provide dental care for people unable to access care from high street dentists. This includes vulnerable children. Dental decay is a common finding in cases of child neglect. Effective communication between community dentists and school nurses will help identify children who are suffering neglect.

Current problem: In Northumbria CDS we use paper based clinical records and to share dental information with school nurses about a vulnerable child requires a [letter] to be generated by the dentist, saved as PDF and sent via email. Last month 9.5 days of dentist's time was spent writing these letters. We also want incorporate aspects of the [Dental Health Risk score app (RAG)](https://github.com/openGPSoC/dental_RAG-score) that was built at a recent NHS Hackday.

###Scenario objectives

1. Populate the Patient Demographics via a FHIR-like Patient API provided by Neovahealth / Black Pear software
2. Create the Dental Assessment data entry form
3. Persist the completed Dental Assessment data entry form to the HANDI-HOPD platform (Ehrscape API)
4. Create a service which transforms the persisted document to a PDF for attachment to an email.
5. Re-persist the openEHR document to other openEHR vendor servers (OceanEHR, Code24, Cabolabs).

It is expected that most hack teams will concentrate on items 1,2,3.   
We have identified a team who are happy to concentrate on items 4 and 5.

###What has been pre-prepared
To ensure that the app challenge can progress rapidly, a small number of assets have been pre-prepared

*   openEHR archetypes and 'Dental Assessment Final Report' template, defining the taget dataset 'schema'
*   openEHR Dental Assessment Final Report' instance data examples matching the target dataset schema
*   A minimal Prototype Dental Assesment data entry web app

###The prototype Dental Assessment data entry web app
 A [simple prototype app](http://c4hdental-handihopd.rhcloud.com/) with [source code on GitHub.](https://github.com/handihealth/C4H_dental_challenge) has been provided to help clarify the clinical requirements and the RAG Risk score algorithm, but does not include any integration with demographics or Ehrscape APIs. Hack teams are, of course, welcome to create a very different UI. 

 The key challenge for hack teams is to map the data fields into a target openEHR JSON string (to be provided). That string is then passed to the Ehrscape API for persistence.

####Key open*EHR* datatypes
openEHR has a very rich set of allowable datatypes. A full defiinition is beyond the scope of this document but developers new to this field may find the follwoing notes helpful

**text / codedText**
codedText is a commonly used datatype in openEHR systems and is a sub-class of text. i.e whereever ext is specified codedText can be used instead.   
Codes may be 'external' e.g. SNOMED CT or 'local', where they are defined within archetypes and have the form 'atxxxxx'.   
A codedText element always includes the terminologyID, the code itself and the text of the coded concept (Rubric).  
Where a codedText item is required, allowed value(s) are expressed in the form:  

	terminologyId::code::rubric
	
	e.g. local::at0007::Dentalswelling
	or   SNOMED-CT::123456::No pathology found

**ordinal**
'ordinal' is a datatype which combines coded_text with a score, expressed as an integer.  
   
*  0 Green `local::at0022::Green`    
*  1 Amber `local::at0023::Amber`   
*  2 Red   `local::at0024::Red`  
 
###The Dental Assessment dataset 
The dataset for the Dental Assessment form is defined as an 'openEHR template'. This is assembled  from a number of open source component 'archetypes' e.g. 'Symptom', 'Physical Examination' etc. These are brought together into a 'template' and further constrained to fit the Dental Assessment use-case.

####'Assessed by' section
**Dentist name:** `datatype=text`  
**Clinic address:** `datatype=text`  
**Date assessed:** `datatype=date (Use ISO 8061 format e.g. 2005-10-18T00:00:00.000+02:00)`  

####Primary School section
**Primary school contact name (person):** `datatype=text`  
**Contact details phone, email etc:** `datatype=text`   
**Name of school:** `datatype=text`  

####History Section
**Dental pain symptom:** `datatype=codedText: "SNOMED-CT::102616008::Painful mouth" (only include code if Dental pain symptom is present).`

####Examination Findings Section
**Number of teeth with decay (0-32):** `datatype=count:0-32 (integer)`  

**Dental swelling:** `datatype=codedText`  
  
* Dental swelling present `local::at0005::Dental swelling present`   
* Dental swelling absent  `local::at0006::Dental swelling absent` 
	 
**Plaque control:**  `datatype=codedText`  

* Good plaque control `local:at00002::Good plaque control` 
* Poor plaque control `local::at0003::Poor plaque control`  
 
####Radiology Findings section
*Either*  

  **No problems detected:** `datatype=codedText: SNOMED-CT::23875004:No diagnostic abnormality`    

*or* 
   
  **Number of teeth with decay (0-32):** `datatype=count:0-32 (integer)`   
  **Teeth with abscess (0-32):**`datatype=count:0-32 (integer)`  
 
####Dental RAG Score section
For this application only the Caries (Tooth decay) aspect of the original RAG score is required.  

**Clinical Factors:** `datatype=codedText (internal code)`  

* Teeth with carious lesions `local::at0025::Teeth with carious lesions` 
* No teeth with carious lessions `local::at0026::No teeth with carious lesions`  

**Patient Factors:**  `datatype=codedText [0..*] (multiple internal codes)`  

 *  Symptoms `local::at0027::Symptoms`  
 *  Diet - Excess sugar / frequent sugar `local::at0028::Diet - Excess sugar / frequent sugar`   
 *  Unsatisfactory Plaque control `local::at0029::Unsatisfactory Plaque control`  
 *  Sibling experience `local::at0030::Sibling experience`  
 
**Risk Score:** `ordinal` 

The score (Green | Amber | Red) for each RAG section is captured as an ordinal i.e. a codedText with an associated integer. 

*  0 Green `local::at0022::Green`  
*  1 Amber `local::at0023::Amber`  
*  2 Red   `local::at0024::Red`  
 
####Treatment planned section
**Treatment planned :** `text [0..*]`  

####Follow-up arrangements section
**Follow-up arrangements:** `text [0..*]`  

####Summary section
**Follow-up arrangements:** `text [0..*]`  


##Technical objectives

###A. Retrieve Patient Demographics

Retreive First name, Last Name, Address, Date of Birth, NHS Number, Gender.

The API will follow the FHIR Patient resource very closely and is likely to be of the form:

    GET {{baseurl}}/patient/?identifer={{nhsNumber}} where nhsNumber=7430345
		
		
Two servers are avaiable

*  [BlackPear FHIRBall server](https://pyruscloud.blackpear.com/fhir/Patient?identifier=7430345)  
*  [NeovaHealth FHIR server](http://nhsdemo.openeobs.net/api/v1/patient?identifier=7430345) (needs Basic Authentication: login=fhir_api pwd=fhir_api))

This will return a FHIR JSON string aligned with the [FHIR Patient resource.](http://hl7-fhir.github.io/patient.html)

e.g. [FHIR JSON Patient Example](https://github.com/handihealth/C4H_dental_challenge/blob/master/technical/instances/fhir%20child%20female.json)


###B. Develop Dental Assessment form 

Hack teams are free to develop the Dental Assessment data entry form in any way they choose, so long as the key requirements are met. We expect a number of community dental stakeholders to be on-hand to offer advice and feedback. The prime objective is to be able ot share the data collected in an interoperable format.

Tablet or desktop formats are probably more appropriate to this use-case than phone formats.

###C. Persist the Dental Assessment Form as openEHR via HANDI-HOPD Ehrscape

All openEHR data is persisted as a COMPOSITION class. openEHR data can be highly structured and potentially complex. To simplify the challenge of persisting openEHR data, examples of Dental Assessment 'target composition' data instanceshave been provided in different formats. HANDI-HOPD EhrScape will accept any of these formats and the data is in each example is persisted identically. Other openEHR servers such as OceanEHR, Code24 and Cabolabs currently only support the RAW XML format.

Once the data is assembled in the correct format, the actual service call is very simple requiring only the setting of simple paramters and headers.

**Example openEHR target Composition documents**

[openEHR Structured JSON](https://github.com/handihealth/C4H_dental_challenge/blob/master/technical/instances/AoMRC%20Community%20Dental%20Assessment%20(STRUCTURED.json)
[openEHR Flat JSON](https://github.com/handihealth/C4H_dental_challenge/blob/master/technical/instances/AoMRC%20Community%20Dental%20Assessment%20(FLAT.json)
[openEHR Raw XML](https://github.com/handihealth/C4H_dental_challenge/blob/master/technical/instances/AoMRC%20Community%20Dental%20Assessment%20(RAW.xml)



##openEHR and HANDI-HOPD Ehrscape


TBD

The Ehrscape API developed by Marand, provides a simple Restful API which hides much of the complexity of the underlying openEHR server.



Handling specific datatypes

text

codedText

ordinal

date


Multiple occurrence data

